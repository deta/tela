import{u as H,s as de,S as ge,i as Oe,F as ze,a as F,e as k,d as Q,c as I,b as C,f as w,h as M,j as T,k as B,z as V,G as ve,H as De,I as Se,m as Ee,t as Me,T as Ye,n as Xe,U as E,V as q,E as Ne,P as Le,W as z,w as Z,x as G,y as J,X as re,Q as Ue}from"./index-eaaa2899.js";import{c as W,h as fe,d as Be}from"./Positionable-51bce168.js";const Pe=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,P=[];function ke(f,n=H){let t;const i=new Set;function l(u){if(de(f,u)&&(f=u,t)){const m=!P.length;for(const r of i)r[1](),P.push(r,f);if(m){for(let r=0;r<P.length;r+=2)P[r][0](P[r+1]);P.length=0}}}function d(u){l(u(f))}function s(u,m=H){const r=[u,m];return i.add(r),i.size===1&&(t=n(l,d)||H),u(f),()=>{i.delete(r),i.size===0&&t&&(t(),t=null)}}return{set:l,update:d,subscribe:s}}const{window:le}=Pe;function ce(f){var d,s;let n,t,i=((d=f[8].DEV)==null?void 0:d.SHOW_POS)&&ue(f),l=((s=f[8].DEV)==null?void 0:s.SHOW_MODE)&&ae(f);return{c(){n=k("div"),i&&i.c(),t=F(),l&&l.c(),this.h()},l(u){n=I(u,"DIV",{style:!0});var m=C(n);i&&i.l(m),t=Q(m),l&&l.l(m),m.forEach(w),this.h()},h(){z(n,"position","absolute"),z(n,"right","1ch"),z(n,"top","1ch"),z(n,"background","darkblue"),z(n,"z-index","200"),z(n,"color","#fff"),z(n,"padding","4px"),z(n,"display","flex"),z(n,"gap","2ch"),z(n,"user-select","none"),z(n,"pointer-events","none")},m(u,m){T(u,n,m),i&&i.m(n,null),B(n,t),l&&l.m(n,null)},p(u,m){var r,c;(r=u[8].DEV)!=null&&r.SHOW_POS?i?i.p(u,m):(i=ue(u),i.c(),i.m(n,t)):i&&(i.d(1),i=null),(c=u[8].DEV)!=null&&c.SHOW_MODE?l?l.p(u,m):(l=ae(u),l.c(),l.m(n,null)):l&&(l.d(1),l=null)},d(u){u&&w(n),i&&i.d(),l&&l.d()}}}function ue(f){let n,t=f[2].viewOffset.x+"",i,l,d=f[2].viewOffset.y+"",s;return{c(){n=k("span"),i=Z(t),l=Z(" - "),s=Z(d)},l(u){n=I(u,"SPAN",{});var m=C(n);i=G(m,t),l=G(m," - "),s=G(m,d),m.forEach(w)},m(u,m){T(u,n,m),B(n,i),B(n,l),B(n,s)},p(u,m){m&4&&t!==(t=u[2].viewOffset.x+"")&&J(i,t),m&4&&d!==(d=u[2].viewOffset.y+"")&&J(s,d)},d(u){u&&w(n)}}}function ae(f){let n,t;return{c(){n=k("span"),t=Z(f[3])},l(i){n=I(i,"SPAN",{});var l=C(n);t=G(l,f[3]),l.forEach(w)},m(i,l){T(i,n,l),B(n,t)},p(i,l){l&8&&J(t,i[3])},d(i){i&&w(n)}}}function me(f){let n;return{c(){n=k("div"),this.h()},l(t){n=I(t,"DIV",{class:!0,style:!0}),C(n).forEach(w),this.h()},h(){M(n,"class","selection-rect svelte-xlkx4x"),M(n,"style",f[6])},m(t,i){T(t,n,i)},p(t,i){i&64&&M(n,"style",t[6])},d(t){t&&w(n)}}}function Ie(f){let n=Object.values(f[8].DEV).includes(!0),t,i,l,d,s,u,m,r=n&&ce(f),c=(f[3]==="select"||f[3]==="draw")&&me(f);const X=f[16].default,_=ze(X,f,f[15],null);return{c(){r&&r.c(),t=F(),i=k("div"),l=k("div"),c&&c.c(),d=F(),_&&_.c(),this.h()},l(a){r&&r.l(a),t=Q(a),i=I(a,"DIV",{class:!0,style:!0});var y=C(i);l=I(y,"DIV",{class:!0,style:!0});var g=C(l);c&&c.l(g),d=Q(g),_&&_.l(g),g.forEach(w),y.forEach(w),this.h()},h(){M(l,"class","board svelte-xlkx4x"),M(l,"style",f[7]),M(i,"class","container svelte-xlkx4x"),M(i,"style",f[5])},m(a,y){r&&r.m(a,y),T(a,t,y),T(a,i,y),B(i,l),c&&c.m(l,null),B(l,d),_&&_.m(l,null),f[17](i),s=!0,u||(m=[V(le,"keydown",f[11]),V(le,"keyup",f[12]),V(i,"mousedown",f[13]),V(i,"touchstart",f[13],{passive:!1}),V(i,"wheel",f[10],{passive:!1})],u=!0)},p(a,[y]){y&256&&(n=Object.values(a[8].DEV).includes(!0)),n?r?r.p(a,y):(r=ce(a),r.c(),r.m(t.parentNode,t)):r&&(r.d(1),r=null),a[3]==="select"||a[3]==="draw"?c?c.p(a,y):(c=me(a),c.c(),c.m(l,d)):c&&(c.d(1),c=null),_&&_.p&&(!s||y&32768)&&ve(_,X,a,a[15],s?Se(X,a[15],y,null):De(a[15]),null),(!s||y&128)&&M(l,"style",a[7]),(!s||y&32)&&M(i,"style",a[5])},i(a){s||(Ee(_,a),s=!0)},o(a){Me(_,a),s=!1},d(a){a&&(w(t),w(i)),r&&r.d(a),c&&c.d(),_&&_.d(a),f[17](null),u=!1,Ye(m)}}}function Ce(){document.body.classList.add("panning")}function Te(f,n,t){let i,l,d,s,u=H,m=()=>(u(),u=re(O,o=>t(2,s=o)),O),r,c,X=H,_=()=>(X(),X=re(g,o=>t(8,c=o)),g);f.$$.on_destroy.push(()=>u()),f.$$.on_destroy.push(()=>X());let{$$slots:a={},$$scope:y}=n,{settings:g}=n;_();let{board:O}=n;m();const N=Xe();E(g,c={CAN_ZOOM:!0,SNAP_TO_GRID:!1,GRID_SIZE:20,CULL:!0,CULL_MARGIN:400,DEV:{SHOW_POS:!1,SHOW_MODE:!1},...c,BOUNDS:{minX:null,maxX:null,minY:null,maxY:null,maxZoom:3,minZoom:0,limit:"hard",...c.BOUNDS}},c),E(O,s={zoom:1,viewOffset:{x:0,y:0},viewSize:{x:1280,y:720},viewPort:{x:0,y:0,w:0,h:0},...s},s),q("board",O),q("settings",g);let S=ke("draw");Ne(f,S,o=>t(3,r=o)),q("mode",S);let K,Y={init:{x:0,y:0},curr:{x:0,y:0},offset:{x:0,y:0}},e={init:{x:0,y:0},curr:{x:0,y:0},offset:{x:0,y:0},pos:{x:0,y:0},size:{x:0,y:0}};function $(o,b){return{x:o-s.viewPort.x,y:b-s.viewPort.y+window.scrollY}}function ye(){document.body.classList.add("drawing"),N("drawStart")}function ee(){document.body.classList.remove("drawing"),document.removeEventListener("mousemove",oe),t(14,e={init:{x:0,y:0},curr:{x:0,y:0},offset:{x:0,y:0},pos:{x:0,y:0},size:{x:0,y:0}})}function te(){document.body.classList.remove("panning"),document.removeEventListener("mousemove",R),N("panEnd",{offset:s.viewOffset})}function pe(){N("selectStart"),document.body.classList.add("selecting"),document.addEventListener("mousemove",j)}function se(){document.body.classList.remove("selecting"),document.removeEventListener("mousemove",j)}function he(o){if(o.ctrlKey){if(o.preventDefault(),o.stopPropagation(),!c.CAN_ZOOM)return;E(S,r="zoom",r);const b=s.viewOffset.x+o.clientX/s.zoom,p=s.viewOffset.y+o.clientY/s.zoom,h=o.deltaY,x=W(s.zoom-h/500,.1,1.9);E(O,s.zoom=x,s);const v=s.viewOffset.x+o.clientX/x,D=s.viewOffset.y+o.clientY/x,L=b-v,U=p-D;E(O,s.viewOffset={x:s.viewOffset.x+L,y:s.viewOffset.y+U},s)}else{if(fe(o.target,"tela-ignore"))return;o.preventDefault(),o.stopPropagation();const b=o.deltaX,p=o.deltaY,h=W(s.viewOffset.x+b,c.BOUNDS.minX!==null?c.BOUNDS.minX:-1/0,c.BOUNDS.maxX!==null?c.BOUNDS.maxX-window.innerWidth:1/0),x=W(s.viewOffset.y+p,c.BOUNDS.minY!==null?c.BOUNDS.minY:-1/0,c.BOUNDS.maxY!==null?c.BOUNDS.maxY-window.innerHeight:1/0);E(O,s.viewOffset={x:h,y:x},s),Be("remove_trackpad_panning",100,()=>document.body.classList.remove("panning"))}N("zoomEnd",{zoom:s.zoom})}function _e(o){o.shiftKey?S.set("select"):o.metaKey&&S.set("pan")}function xe(o){!o.shiftKey&&!o.metaKey&&(r==="draw"&&ee(),(r==="pan"||r==="panning")&&te(),r==="select"&&se(),S.set("draw"))}function be(o){var x,v,D,L,U,ne,ie;const b=((v=(x=o.targetTouches)==null?void 0:x.item(0))==null?void 0:v.target)||o.target,{x:p,y:h}=$(((L=(D=o.targetTouches)==null?void 0:D.item(0))==null?void 0:L.clientX)||o.clientX,((ne=(U=o.targetTouches)==null?void 0:U.item(0))==null?void 0:ne.clientY)||o.clientY);fe(b,"tela-ignore")||((r==="pan"||((ie=o.targetTouches)==null?void 0:ie.length)===1)&&S.set("panning"),r==="draw"?(o.stopPropagation(),ye(),t(14,e.init={x:p,y:h},e),t(14,e.curr={x:p,y:h},e),t(14,e.pos={x:p,y:h},e),t(14,e.size={x:0,y:0},e),document.addEventListener("mousemove",oe),document.addEventListener("mouseup",A,{once:!0})):r==="panning"?(o.stopPropagation(),Ce(),Y.init={x:p,y:h},Y.curr={x:p,y:h},document.addEventListener("mousemove",R),document.addEventListener("mouseup",A,{once:!0}),document.addEventListener("touchmove",R),document.addEventListener("touchend",A,{once:!0})):r==="select"&&(o.stopPropagation(),pe(),t(14,e.init={x:p,y:h},e),t(14,e.curr={x:p,y:h},e),t(14,e.pos={x:p,y:h},e),t(14,e.size={x:0,y:0},e),document.addEventListener("mousemove",j),document.addEventListener("mouseup",A,{once:!0})))}function R(o){var v,D,L,U;const b=((D=(v=o.targetTouches)==null?void 0:v.item(0))==null?void 0:D.clientX)||o.clientX,p=((U=(L=o.targetTouches)==null?void 0:L.item(0))==null?void 0:U.clientY)||o.clientY;Y.offset={x:Math.floor(b-Y.curr.x),y:Math.floor(p-Y.curr.y)},Y.curr={x:b,y:p};const h=W(s.viewOffset.x-Y.offset.x,c.BOUNDS.minX!==null?c.BOUNDS.minX:-1/0,c.BOUNDS.maxX!==null?c.BOUNDS.maxX-window.innerWidth:1/0),x=W(s.viewOffset.y-Y.offset.y,c.BOUNDS.minY!==null?c.BOUNDS.minY:-1/0,c.BOUNDS.maxY!==null?c.BOUNDS.maxY-window.innerHeight:1/0);E(O,s.viewOffset={x:h,y:x},s)}function j(o){t(14,e.offset={x:-Math.floor(e.init.x-e.curr.x),y:-Math.floor(e.init.y-e.curr.y)},e),t(14,e.pos.x=e.init.x,e),t(14,e.pos.y=e.init.y,e),t(14,e.size.x=e.offset.x/s.zoom,e),t(14,e.size.y=e.offset.y/s.zoom,e),e.size.x<0&&(t(14,e.size.x=Math.abs(e.offset.x/s.zoom),e),t(14,e.pos.x=e.init.x-e.size.x*s.zoom,e)),e.size.y<0&&(t(14,e.size.y=Math.abs(e.offset.y/s.zoom),e),t(14,e.pos.y=e.init.y-e.size.y*s.zoom,e)),t(14,e.curr={x:o.clientX,y:o.clientY},e),N("selectMove",{selectState:e})}function oe(o){var h,x,v,D;const{x:b,y:p}=$(((x=(h=o.targetTouches)==null?void 0:h.item(0))==null?void 0:x.clientX)||o.clientX,((D=(v=o.targetTouches)==null?void 0:v.item(0))==null?void 0:D.clientY)||o.clientY);t(14,e.offset={x:-Math.floor(e.init.x-e.curr.x),y:-Math.floor(e.init.y-e.curr.y)},e),t(14,e.pos.x=e.init.x,e),t(14,e.pos.y=e.init.y,e),t(14,e.size.x=e.offset.x/s.zoom,e),t(14,e.size.y=e.offset.y/s.zoom,e),e.size.x<0&&(t(14,e.size.x=Math.abs(e.offset.x/s.zoom),e),t(14,e.pos.x=e.init.x-e.size.x*s.zoom,e)),e.size.y<0&&(t(14,e.size.y=Math.abs(e.offset.y/s.zoom),e),t(14,e.pos.y=e.init.y-e.size.y*s.zoom,e)),t(14,e.curr={x:b,y:p},e)}function A(o){r==="draw"?(N("drawEnd",{selection:{pos:e.pos,size:e.size}}),ee()):r==="panning"?(E(S,r="pan",r),te()):r==="select"&&(se(),N("selectEnd",{selectState:e}),t(14,e={init:{x:0,y:0},curr:{x:0,y:0},offset:{x:0,y:0},pos:{x:0,y:0},size:{x:0,y:0}}))}Le(()=>{const o=K.getBoundingClientRect();E(O,s.viewPort={x:o.x,y:o.y,w:o.right-o.left,h:o.bottom-o.top},s)});function we(o){Ue[o?"unshift":"push"](()=>{K=o,t(4,K)})}return f.$$set=o=>{"settings"in o&&_(t(0,g=o.settings)),"board"in o&&m(t(1,O=o.board)),"$$scope"in o&&t(15,y=o.$$scope)},f.$$.update=()=>{f.$$.dirty&4&&t(7,i=`transform-origin: top left; transform: scale(${s.zoom}) translate(${-s.viewOffset.x}px, ${-s.viewOffset.y}px);`),f.$$.dirty&16388&&t(6,l=`transform: translate(${s.viewOffset.x+e.pos.x/s.zoom}px, ${s.viewOffset.y+e.pos.y/s.zoom}px); width: ${Math.round(e.size.x)}px; height: ${Math.round(e.size.y)}px;`),f.$$.dirty&8&&t(5,d=`cursor: ${r==="draw"?"crosshair":r==="select"?"default":r==="pan"?"grab":r==="panning"?"grabbing":"crosshair"};`)},[g,O,s,r,K,d,l,i,c,S,he,_e,xe,be,e,y,a,we]}class He extends ge{constructor(n){super(),Oe(this,n,Te,Ie,de,{settings:0,board:1})}}export{He as B,ke as w};
//# sourceMappingURL=Board-b886af08.js.map
