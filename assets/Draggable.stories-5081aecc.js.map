{"version":3,"file":"Draggable.stories-5081aecc.js","sources":["../../src/lib/Draggable.svelte","../../src/stories/DraggableStory.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { createEventDispatcher, getContext } from \"svelte\";\n  import type { Vec2 } from \"./types/Utils.type.js\";\n  import type { Writable } from \"svelte/store\";\n  import type { TBoard, TBoardSettings } from \"./types/Board.type.js\";\n  import { hasClassOrParentWithClass, snapToGrid } from \"./utils.js\";\n\n  export let pos: Vec2;\n  export let size: Vec2;\n\n  const dispatch = createEventDispatcher();\n\n  const board = getContext<Writable<TBoard>>(\"board\");\n  const settings = getContext<Writable<TBoardSettings>>(\"settings\");\n\n  let dragState = {\n    init: { x: 0, y: 0 },\n    curr: { x: 0, y: 0 },\n    offset: { x: 0, y: 0 }\n  };\n\n  // UI Handlers\n  function onMouseDown(e: MouseEvent) {\n    if (hasClassOrParentWithClass(e.target as HTMLElement, \"tela-ignore\")) return;\n    e.stopPropagation();\n    document.body.classList.add(\"dragging\");\n    let cX = e.clientX;\n    let cY = e.clientY;\n    // todo: handle touch\n\n    const x = $settings.SNAP_TO_GRID ? snapToGrid(cX, $settings.GRID_SIZE!) : cX;\n    const y = $settings.SNAP_TO_GRID ? snapToGrid(cY, $settings.GRID_SIZE!) : cY;\n\n    dragState.init = { x, y };\n    dragState.curr = { x, y };\n\n    document.addEventListener(\"mousemove\", onMouseMove);\n    document.addEventListener(\"mouseup\", onMouseUp, { once: true });\n\n    dispatch(\"dragStart\", { pos });\n  }\n\n  function onMouseMove(e: MouseEvent) {\n    let cX = e.clientX;\n    let cY = e.clientY;\n\n    dragState.offset = {\n      x: (cX - dragState.curr.x) / $board.zoom,\n      y: (cY - dragState.curr.y) / $board.zoom\n    };\n\n    dragState.curr = { x: e.clientX, y: e.clientY };\n\n      // todo: optimize setting pos?\n\n      const newX = pos.x + dragState.offset.x;\n      const newY = pos.y + dragState.offset.y;\n\n      if ($settings.BOUNDS?.minX !== null && newX < $settings.BOUNDS!.minX) {\n        pos.x = $settings.BOUNDS!.minX;\n      }\n      else if ($settings.BOUNDS?.maxX !== null && newX + size.x > $settings.BOUNDS!.maxX) {\n        pos.x = $settings.BOUNDS!.maxX - size.x;\n      }\n      else {\n        pos.x += dragState.offset.x;\n      }\n\n      if ($settings.BOUNDS?.minY !== null && newY < $settings.BOUNDS!.minY) {\n        pos.y = $settings.BOUNDS!.minY;\n      }\n      else if ($settings.BOUNDS?.maxY !== null && newY + size.y > $settings.BOUNDS!.maxY) {\n        pos.y = $settings.BOUNDS!.maxY - size.y;\n      }\n      else {\n        pos.y += dragState.offset.y;\n      }\n\n      dispatch(\"dragMove\", { pos, offset: dragState.offset });\n  }\n\n  function onMouseUp(e: MouseEvent) {\n    document.body.classList.remove(\"dragging\");\n    document.removeEventListener(\"mousemove\", onMouseMove);\n    dispatch(\"dragEnd\", { pos });\n  }\n</script>\n\n<svelte:element\n  this=\"div\"\n  {...$$restProps}\n  class=\"draggable {$$restProps.class || ''}\"\n  on:mousedown={onMouseDown}\n>\n  <slot />\n</svelte:element>\n","<script lang=\"ts\">\n  import Board from \"$lib/Board.svelte\";\n  import Positionable from \"$lib/Positionable.svelte\";\n  import Draggable from \"$lib/Draggable.svelte\";\n  import type { TBoard, TBoardSettings, Vec2 } from \"$lib/index.js\";\n  import { writable } from \"svelte/store\";\n\n  export let pos: Vec2 = { x: 0, y: 0 };\n  export let size: Vec2 = { x: 100, y: 100 };\n\n  const settings = writable({} satisfies TBoardSettings);\n\n  const board = writable({\n    viewOffset: { x: 0, y: 0 },\n    zoom: 1\n  } satisfies TBoard);\n\n  const element = { pos, size };\n  const el2 = { pos: { x: 200, y: 200 }, size: { x: 100, y: 100 } };\n</script>\n\n<main class=\"draggableStory\">\n  <Board {settings} {board}>\n    <Positionable pos={element.pos} size={element.size} z={1}>\n      <Draggable bind:pos={element.pos} bind:size={element.size}>\n      drag here.\n      </Draggable>\n      Positionable\n    </Positionable>\n    <Positionable pos={el2.pos} size={el2.size} z={1}>\n      <Draggable bind:pos={el2.pos} bind:size={el2.size}>\n      drag here.\n      </Draggable>\n      Positionable\n    </Positionable>\n  </Board>\n</main>\n\n<style>\n  main {\n    height: 500px;\n  }\n  :global(.draggableStory .draggable) {\n    background: lightgray;\n  }\n</style>"],"names":["ctx","insert_hydration","target","div","anchor","div_class_value","pos","$$props","size","dispatch","createEventDispatcher","board","getContext","settings","dragState","onMouseDown","e","hasClassOrParentWithClass","cX","cY","x","$settings","snapToGrid","y","onMouseMove","onMouseUp","$board","newX","newY","_a","_b","$$invalidate","_c","_d","draggable_props","draggable_changes","dirty","positionable0_changes","positionable1_changes","main","writable","element","el2","$$self","value"],"mappings":"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"}