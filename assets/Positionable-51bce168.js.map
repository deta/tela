{"version":3,"file":"Positionable-51bce168.js","sources":["../../src/lib/utils.ts","../../src/lib/Positionable.svelte"],"sourcesContent":["export const lerp = (a: number, b: number, t: number) => a * (1 - t) + b * t;\nexport const clamp = (a: number, min = 0, max = 1) => Math.min(max, Math.max(min, a));\nexport const invlerp = (x: number, y: number, a: number) => clamp((a - x) / (y - x));\nexport const map = (x1: number, y1: number, x2: number, y2: number, a: number) =>\n  lerp(x2, y2, invlerp(x1, y1, a));\n\nexport function hasClassOrParentWithClass(element: HTMLElement, className: string): boolean {\n  if (!element) {\n    return false;\n  }\n\n  if (element.classList.contains(className)) {\n    return true;\n  }\n\n  if (element.parentElement) return hasClassOrParentWithClass(element.parentElement, className);\n  else return false;\n}\n\nexport function snapToGrid(value: number, snap: number): number {\n  return Math.round(value / snap) * snap;\n}\n\nconst debounceMap = new Map();\nexport function debounce(id: string, ms: number, callback: () => void) {\n  if (debounceMap.has(id)) clearTimeout(debounceMap.get(id));\n  const timer = setTimeout(callback, ms);\n  debounceMap.set(id, timer);\n}\n\nexport function isBrowser() {\n  return typeof window !== \"undefined\";\n}","<script lang=\"ts\">\n  import { getContext } from \"svelte\";\n  import type { Writable } from \"svelte/store\";\n  import type { Vec2 } from \"./types/Utils.type.js\";\n  import type { TBoard, TBoardSettings } from \"./types/Board.type.js\";\n  import { isBrowser, snapToGrid } from \"./utils.js\";\n\n  export let pos: Vec2;\n  export let size: Vec2;\n  export let z: number = 1;\n\n  const board = getContext<Writable<TBoard>>(\"board\");\n  const settings = getContext<Writable<TBoardSettings>>(\"settings\");\n\n  $: transformCss = `transform: translate(${\n    $settings.SNAP_TO_GRID ? snapToGrid(pos.x, $settings.GRID_SIZE!) : pos.x\n  }px, ${\n    $settings.SNAP_TO_GRID ? snapToGrid(pos.y, $settings.GRID_SIZE!) : pos.y\n  }px); width: ${\n    $settings.SNAP_TO_GRID ? snapToGrid(size.x, $settings.GRID_SIZE!) : size.x\n  }px; height: ${\n    $settings.SNAP_TO_GRID ? snapToGrid(size.y, $settings.GRID_SIZE!) : size.y\n  }px; z-index: ${z};`;\n  $: inView = isVisible($board.viewOffset)\n\n  function isVisible(viewOffset: Vec2, viewport: Vec2 = { x: 620, y: 340 }) {\n    if (isBrowser()) {\n      viewport.x = window.innerWidth;\n      viewport.y = window.innerHeight;\n    }\n    return (\n      pos.x > viewOffset.x - $settings.CULL_MARGIN! &&\n      pos.y > viewOffset.y - $settings.CULL_MARGIN! &&\n      pos.x + size.x < viewOffset.x + $settings.CULL_MARGIN! + viewport.x / $board.zoom && // todo: use bounding rect not window\n      pos.y + size.y < viewOffset.y + $settings.CULL_MARGIN! + viewport.y / $board.zoom\n    );\n  }\n\n</script>\n\n{#if !$settings.CULL || inView}\n<svelte:element\n  this=\"div\"\n  {...$$restProps}\n  class=\"positionable {$$restProps.class || ''}\"\n  style=\"{transformCss} {$$restProps.style || ''}\"\n>\n  <slot />\n</svelte:element>\n{/if}\n\n<style>\n  .positionable {\n    position: absolute;\n    top: 0;\n    left: 0;\n    transform-origin: top left;\n\n    transform-style: preserve-3d;\n    backface-visibility: hidden;\n  }\n</style>\n"],"names":["clamp","a","min","max","hasClassOrParentWithClass","element","className","snapToGrid","value","snap","debounceMap","debounce","id","ms","callback","timer","isBrowser","ctx","div_style_value","insert_hydration","target","div","anchor","div_class_value","current","dirty","create_if_block","pos","$$props","size","z","board","getContext","settings","isVisible","viewOffset","viewport","$settings","$board","$$invalidate","transformCss","inView"],"mappings":"kPACO,MAAMA,GAAQ,CAACC,EAAWC,EAAM,EAAGC,EAAM,IAAM,KAAK,IAAIA,EAAK,KAAK,IAAID,EAAKD,CAAC,CAAC,EAKpE,SAAAG,EAA0BC,EAAsBC,EAA4B,CAC1F,OAAKD,EAIDA,EAAQ,UAAU,SAASC,CAAS,EAC/B,GAGLD,EAAQ,cAAsBD,EAA0BC,EAAQ,cAAeC,CAAS,EAChF,GARH,EASX,CAEgB,SAAAC,EAAWC,EAAeC,EAAsB,CAC9D,OAAO,KAAK,MAAMD,EAAQC,CAAI,EAAIA,CACpC,CAEA,MAAMC,MAAkB,IACR,SAAAC,GAASC,EAAYC,EAAYC,EAAsB,CACjEJ,EAAY,IAAIE,CAAE,GAAgB,aAAAF,EAAY,IAAIE,CAAE,CAAC,EACnD,MAAAG,EAAQ,WAAWD,EAAUD,CAAE,EACzBH,EAAA,IAAIE,EAAIG,CAAK,CAC3B,CAEO,SAASC,GAAY,CAC1B,OAAO,OAAO,OAAW,GAC3B,4ECWMC,EAAW,CAAA,4BACMA,EAAW,CAAA,EAAC,OAAS,MAClC,MAAAC,EAAAD,EAAe,CAAA,EAAA,KAAAA,EAAY,CAAA,EAAA,OAAS,0NAJ9CE,EAOgBC,EAAAC,EAAAC,CAAA,sHALVL,EAAW,CAAA,qCACMA,EAAW,CAAA,EAAC,OAAS,OAAE,CAAA,MAAAM,CAAA,GACpC,CAAAC,GAAAC,EAAA,IAAAP,KAAAA,EAAAD,EAAe,CAAA,EAAA,KAAAA,EAAY,CAAA,EAAA,OAAS,OAAE,CAAA,MAAAC,CAAA,2HAL1CD,EAAS,CAAA,EAAC,MAAQA,EAAM,CAAA,IAAAS,EAAAT,CAAA,+FAAxBA,EAAS,CAAA,EAAC,MAAQA,EAAM,CAAA,wQAjCjB,CAAA,IAAAU,CAAA,EAAAC,EACA,CAAA,KAAAC,CAAA,EAAAD,GACA,EAAAE,EAAY,CAAA,EAAAF,EAEjB,MAAAG,EAAQC,EAA6B,OAAO,qBAC5C,MAAAC,EAAWD,EAAqC,UAAU,qBAavD,SAAAE,EAAUC,EAAkBC,EAAA,CAAmB,EAAG,IAAK,EAAG,KAAA,CAC7D,OAAApB,EAAA,IACFoB,EAAS,EAAI,OAAO,WACpBA,EAAS,EAAI,OAAO,aAGpBT,EAAI,EAAIQ,EAAW,EAAIE,EAAU,aACjCV,EAAI,EAAIQ,EAAW,EAAIE,EAAU,aACjCV,EAAI,EAAIE,EAAK,EAAIM,EAAW,EAAIE,EAAU,YAAeD,EAAS,EAAIE,EAAO,MAC7EX,EAAI,EAAIE,EAAK,EAAIM,EAAW,EAAIE,EAAU,YAAeD,EAAS,EAAIE,EAAO,iMApBjFC,EAAA,EAAGC,0BACDH,EAAU,aAAe9B,EAAWoB,EAAI,EAAGU,EAAU,SAAU,EAAIV,EAAI,CACzE,OACEU,EAAU,aAAe9B,EAAWoB,EAAI,EAAGU,EAAU,SAAU,EAAIV,EAAI,CACzE,eACEU,EAAU,aAAe9B,EAAWsB,EAAK,EAAGQ,EAAU,SAAU,EAAIR,EAAK,CAC3E,eACEQ,EAAU,aAAe9B,EAAWsB,EAAK,EAAGQ,EAAU,SAAU,EAAIR,EAAK,CAC3E,gBAAgBC,CAAC,GAAA,kBACdS,EAAA,EAAAE,EAASP,EAAUI,EAAO,UAAU,CAAA"}