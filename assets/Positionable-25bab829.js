import{u as R,s as le,S as Se,i as Ee,F as Me,a as ee,e as U,d as te,c as B,b as C,f as g,h as N,j as k,k as X,z as G,G as Le,H as Ne,I as Ie,m as A,t as q,U as Te,n as Ge,V as L,W as Q,E as se,K as Ve,X as S,w as K,x as j,y as ne,Y as ye,L as Re,J as pe,o as Ae,l as We,P as _e,D as be,N as oe,Q as He,O as he,Z as xe}from"./index-6ddd88a4.js";import{g as Ze}from"./spread-8a54911c.js";const Ke=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,T=[];function je(i,s=R){let e;const n=new Set;function r(c){if(le(i,c)&&(i=c,e)){const a=!T.length;for(const l of n)l[1](),T.push(l,i);if(a){for(let l=0;l<T.length;l+=2)T[l][0](T[l+1]);T.length=0}}}function m(c){r(c(i))}function o(c,a=R){const l=[c,a];return n.add(l),n.size===1&&(e=s(r,m)||R),c(i),()=>{n.delete(l),n.size===0&&e&&(e(),e=null)}}return{set:r,update:m,subscribe:o}}const V=(i,s=0,e=1)=>Math.min(e,Math.max(s,i));function ie(i,s){return i?i.classList.contains(s)?!0:i.parentElement?ie(i.parentElement,s):!1:!1}function Z(i,s){return Math.round(i/s)*s}const $=new Map;function qe(i,s,e){$.has(i)&&clearTimeout($.get(i));const n=setTimeout(e,s);$.set(i,n)}function Fe(){return typeof window<"u"}const{window:ge}=Ke;function we(i){var m,o;let s,e,n=((m=i[8].DEV)==null?void 0:m.SHOW_POS)&&ze(i),r=((o=i[8].DEV)==null?void 0:o.SHOW_MODE)&&Oe(i);return{c(){s=U("div"),n&&n.c(),e=ee(),r&&r.c(),this.h()},l(c){s=B(c,"DIV",{style:!0});var a=C(s);n&&n.l(a),e=te(a),r&&r.l(a),a.forEach(g),this.h()},h(){S(s,"position","absolute"),S(s,"right","1ch"),S(s,"top","1ch"),S(s,"background","darkblue"),S(s,"z-index","200"),S(s,"color","#fff"),S(s,"padding","4px"),S(s,"display","flex"),S(s,"gap","2ch"),S(s,"user-select","none"),S(s,"pointer-events","none")},m(c,a){k(c,s,a),n&&n.m(s,null),X(s,e),r&&r.m(s,null)},p(c,a){var l,u;(l=c[8].DEV)!=null&&l.SHOW_POS?n?n.p(c,a):(n=ze(c),n.c(),n.m(s,e)):n&&(n.d(1),n=null),(u=c[8].DEV)!=null&&u.SHOW_MODE?r?r.p(c,a):(r=Oe(c),r.c(),r.m(s,null)):r&&(r.d(1),r=null)},d(c){c&&g(s),n&&n.d(),r&&r.d()}}}function ze(i){let s,e=i[2].viewOffset.x+"",n,r,m=i[2].viewOffset.y+"",o;return{c(){s=U("span"),n=K(e),r=K(" - "),o=K(m)},l(c){s=B(c,"SPAN",{});var a=C(s);n=j(a,e),r=j(a," - "),o=j(a,m),a.forEach(g)},m(c,a){k(c,s,a),X(s,n),X(s,r),X(s,o)},p(c,a){a&4&&e!==(e=c[2].viewOffset.x+"")&&ne(n,e),a&4&&m!==(m=c[2].viewOffset.y+"")&&ne(o,m)},d(c){c&&g(s)}}}function Oe(i){let s,e;return{c(){s=U("span"),e=K(i[3])},l(n){s=B(n,"SPAN",{});var r=C(s);e=j(r,i[3]),r.forEach(g)},m(n,r){k(n,s,r),X(s,e)},p(n,r){r&8&&ne(e,n[3])},d(n){n&&g(s)}}}function ve(i){let s;return{c(){s=U("div"),this.h()},l(e){s=B(e,"DIV",{class:!0,style:!0}),C(s).forEach(g),this.h()},h(){N(s,"class","selection-rect svelte-xlkx4x"),N(s,"style",i[6])},m(e,n){k(e,s,n)},p(e,n){n&64&&N(s,"style",e[6])},d(e){e&&g(s)}}}function Je(i){let s=Object.values(i[8].DEV).includes(!0),e,n,r,m,o,c,a,l=s&&we(i),u=(i[3]==="select"||i[3]==="draw")&&ve(i);const b=i[16].default,p=Me(b,i,i[15],null);return{c(){l&&l.c(),e=ee(),n=U("div"),r=U("div"),u&&u.c(),m=ee(),p&&p.c(),this.h()},l(d){l&&l.l(d),e=te(d),n=B(d,"DIV",{class:!0,style:!0});var _=C(n);r=B(_,"DIV",{class:!0,style:!0});var w=C(r);u&&u.l(w),m=te(w),p&&p.l(w),w.forEach(g),_.forEach(g),this.h()},h(){N(r,"class","board svelte-xlkx4x"),N(r,"style",i[7]),N(n,"class","container svelte-xlkx4x"),N(n,"style",i[5])},m(d,_){l&&l.m(d,_),k(d,e,_),k(d,n,_),X(n,r),u&&u.m(r,null),X(r,m),p&&p.m(r,null),i[17](n),o=!0,c||(a=[G(ge,"keydown",i[11]),G(ge,"keyup",i[12]),G(n,"mousedown",i[13]),G(n,"touchstart",i[13],{passive:!1}),G(n,"wheel",i[10],{passive:!1})],c=!0)},p(d,[_]){_&256&&(s=Object.values(d[8].DEV).includes(!0)),s?l?l.p(d,_):(l=we(d),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null),d[3]==="select"||d[3]==="draw"?u?u.p(d,_):(u=ve(d),u.c(),u.m(r,m)):u&&(u.d(1),u=null),p&&p.p&&(!o||_&32768)&&Le(p,b,d,d[15],o?Ie(b,d[15],_,null):Ne(d[15]),null),(!o||_&128)&&N(r,"style",d[7]),(!o||_&32)&&N(n,"style",d[5])},i(d){o||(A(p,d),o=!0)},o(d){q(p,d),o=!1},d(d){d&&(g(e),g(n)),l&&l.d(d),u&&u.d(),p&&p.d(d),i[17](null),c=!1,Te(a)}}}function Qe(){document.body.classList.add("panning")}function $e(i,s,e){let n,r,m,o,c=R,a=()=>(c(),c=ye(O,f=>e(2,o=f)),O),l,u,b=R,p=()=>(b(),b=ye(w,f=>e(8,u=f)),w);i.$$.on_destroy.push(()=>c()),i.$$.on_destroy.push(()=>b());let{$$slots:d={},$$scope:_}=s,{settings:w}=s;p();let{board:O}=s;a();const y=Ge();L(w,u={CAN_ZOOM:!0,SNAP_TO_GRID:!1,GRID_SIZE:20,CULL:!0,CULL_MARGIN:400,DEV:{SHOW_POS:!1,SHOW_MODE:!1},...u,BOUNDS:{minX:null,maxX:null,minY:null,maxY:null,maxZoom:3,minZoom:0,limit:"hard",...u.BOUNDS}},u),L(O,o={zoom:1,viewOffset:{x:0,y:0},viewSize:{x:1280,y:720},viewPort:{x:0,y:0,w:0,h:0},...o},o),Q("board",O),Q("settings",w);let z=je("draw");se(i,z,f=>e(3,l=f)),Q("mode",z);let W,I={init:{x:0,y:0},curr:{x:0,y:0},offset:{x:0,y:0}},t={init:{x:0,y:0},curr:{x:0,y:0},offset:{x:0,y:0},pos:{x:0,y:0},size:{x:0,y:0}};function re(f,D){return{x:f-o.viewPort.x,y:D-o.viewPort.y+window.scrollY}}function ke(){document.body.classList.add("drawing"),y("drawStart")}function fe(){document.body.classList.remove("drawing"),document.removeEventListener("mousemove",ce),e(14,t={init:{x:0,y:0},curr:{x:0,y:0},offset:{x:0,y:0},pos:{x:0,y:0},size:{x:0,y:0}})}function ue(){document.body.classList.remove("panning"),document.removeEventListener("mousemove",F),y("panEnd",{offset:o.viewOffset})}function Ye(){y("selectStart"),document.body.classList.add("selecting"),document.addEventListener("mousemove",J)}function ae(){document.body.classList.remove("selecting"),document.removeEventListener("mousemove",J)}function Pe(f){if(f.ctrlKey){if(f.preventDefault(),f.stopPropagation(),!u.CAN_ZOOM)return;L(z,l="zoom",l);const D=o.viewOffset.x+f.clientX/o.zoom,h=o.viewOffset.y+f.clientY/o.zoom,x=f.deltaY,v=V(o.zoom-x/500,.1,1.9);L(O,o.zoom=v,o);const E=o.viewOffset.x+f.clientX/v,M=o.viewOffset.y+f.clientY/v,Y=D-E,P=h-M;L(O,o.viewOffset={x:o.viewOffset.x+Y,y:o.viewOffset.y+P},o)}else{if(ie(f.target,"tela-ignore"))return;f.preventDefault(),f.stopPropagation();const D=f.deltaX,h=f.deltaY,x=V(o.viewOffset.x+D,u.BOUNDS.minX!==null?u.BOUNDS.minX:-1/0,u.BOUNDS.maxX!==null?u.BOUNDS.maxX-window.innerWidth:1/0),v=V(o.viewOffset.y+h,u.BOUNDS.minY!==null?u.BOUNDS.minY:-1/0,u.BOUNDS.maxY!==null?u.BOUNDS.maxY-window.innerHeight:1/0);L(O,o.viewOffset={x,y:v},o),qe("remove_trackpad_panning",100,()=>document.body.classList.remove("panning"))}y("zoomEnd",{zoom:o.zoom})}function Xe(f){f.shiftKey?z.set("select"):f.metaKey&&z.set("pan")}function Ue(f){!f.shiftKey&&!f.metaKey&&(l==="draw"&&fe(),(l==="pan"||l==="panning")&&ue(),l==="select"&&ae(),z.set("draw"))}function Be(f){var v,E,M,Y,P,de,me;const D=((E=(v=f.targetTouches)==null?void 0:v.item(0))==null?void 0:E.target)||f.target,{x:h,y:x}=re(((Y=(M=f.targetTouches)==null?void 0:M.item(0))==null?void 0:Y.clientX)||f.clientX,((de=(P=f.targetTouches)==null?void 0:P.item(0))==null?void 0:de.clientY)||f.clientY);ie(D,"tela-ignore")||((l==="pan"||((me=f.targetTouches)==null?void 0:me.length)===1)&&z.set("panning"),l==="draw"?(f.stopPropagation(),ke(),e(14,t.init={x:h,y:x},t),e(14,t.curr={x:h,y:x},t),e(14,t.pos={x:h,y:x},t),e(14,t.size={x:0,y:0},t),document.addEventListener("mousemove",ce),document.addEventListener("mouseup",H,{once:!0})):l==="panning"?(f.stopPropagation(),Qe(),I.init={x:h,y:x},I.curr={x:h,y:x},document.addEventListener("mousemove",F),document.addEventListener("mouseup",H,{once:!0}),document.addEventListener("touchmove",F),document.addEventListener("touchend",H,{once:!0})):l==="select"&&(f.stopPropagation(),Ye(),e(14,t.init={x:h,y:x},t),e(14,t.curr={x:h,y:x},t),e(14,t.pos={x:h,y:x},t),e(14,t.size={x:0,y:0},t),document.addEventListener("mousemove",J),document.addEventListener("mouseup",H,{once:!0})))}function F(f){var E,M,Y,P;const D=((M=(E=f.targetTouches)==null?void 0:E.item(0))==null?void 0:M.clientX)||f.clientX,h=((P=(Y=f.targetTouches)==null?void 0:Y.item(0))==null?void 0:P.clientY)||f.clientY;I.offset={x:Math.floor(D-I.curr.x),y:Math.floor(h-I.curr.y)},I.curr={x:D,y:h};const x=V(o.viewOffset.x-I.offset.x,u.BOUNDS.minX!==null?u.BOUNDS.minX:-1/0,u.BOUNDS.maxX!==null?u.BOUNDS.maxX-window.innerWidth:1/0),v=V(o.viewOffset.y-I.offset.y,u.BOUNDS.minY!==null?u.BOUNDS.minY:-1/0,u.BOUNDS.maxY!==null?u.BOUNDS.maxY-window.innerHeight:1/0);L(O,o.viewOffset={x,y:v},o)}function J(f){e(14,t.offset={x:-Math.floor(t.init.x-t.curr.x),y:-Math.floor(t.init.y-t.curr.y)},t),e(14,t.pos.x=t.init.x,t),e(14,t.pos.y=t.init.y,t),e(14,t.size.x=t.offset.x/o.zoom,t),e(14,t.size.y=t.offset.y/o.zoom,t),t.size.x<0&&(e(14,t.size.x=Math.abs(t.offset.x/o.zoom),t),e(14,t.pos.x=t.init.x-t.size.x*o.zoom,t)),t.size.y<0&&(e(14,t.size.y=Math.abs(t.offset.y/o.zoom),t),e(14,t.pos.y=t.init.y-t.size.y*o.zoom,t)),e(14,t.curr={x:f.clientX,y:f.clientY},t),y("selectMove",{selectState:t})}function ce(f){var x,v,E,M;const{x:D,y:h}=re(((v=(x=f.targetTouches)==null?void 0:x.item(0))==null?void 0:v.clientX)||f.clientX,((M=(E=f.targetTouches)==null?void 0:E.item(0))==null?void 0:M.clientY)||f.clientY);e(14,t.offset={x:-Math.floor(t.init.x-t.curr.x),y:-Math.floor(t.init.y-t.curr.y)},t),e(14,t.pos.x=t.init.x,t),e(14,t.pos.y=t.init.y,t),e(14,t.size.x=t.offset.x/o.zoom,t),e(14,t.size.y=t.offset.y/o.zoom,t),t.size.x<0&&(e(14,t.size.x=Math.abs(t.offset.x/o.zoom),t),e(14,t.pos.x=t.init.x-t.size.x*o.zoom,t)),t.size.y<0&&(e(14,t.size.y=Math.abs(t.offset.y/o.zoom),t),e(14,t.pos.y=t.init.y-t.size.y*o.zoom,t)),e(14,t.curr={x:D,y:h},t)}function H(f){l==="draw"?(y("drawEnd",{selection:{pos:t.pos,size:t.size}}),fe()):l==="panning"?(L(z,l="pan",l),ue()):l==="select"&&(ae(),y("selectEnd",{selectState:t}),e(14,t={init:{x:0,y:0},curr:{x:0,y:0},offset:{x:0,y:0},pos:{x:0,y:0},size:{x:0,y:0}}))}Ve(()=>{const f=W.getBoundingClientRect();L(O,o.viewPort={x:f.x,y:f.y,w:f.right-f.left,h:f.bottom-f.top},o)});function Ce(f){Re[f?"unshift":"push"](()=>{W=f,e(4,W)})}return i.$$set=f=>{"settings"in f&&p(e(0,w=f.settings)),"board"in f&&a(e(1,O=f.board)),"$$scope"in f&&e(15,_=f.$$scope)},i.$$.update=()=>{i.$$.dirty&4&&e(7,n=`transform-origin: top left; transform: scale(${o.zoom}) translate(${-o.viewOffset.x}px, ${-o.viewOffset.y}px);`),i.$$.dirty&16388&&e(6,r=`transform: translate(${o.viewOffset.x+t.pos.x/o.zoom}px, ${o.viewOffset.y+t.pos.y/o.zoom}px); width: ${Math.round(t.size.x)}px; height: ${Math.round(t.size.y)}px;`),i.$$.dirty&8&&e(5,m=`cursor: ${l==="draw"?"crosshair":l==="select"?"default":l==="pan"?"grab":l==="panning"?"grabbing":"crosshair"};`)},[w,O,o,l,W,m,r,n,u,z,Pe,Xe,Ue,Be,t,_,d,Ce]}class it extends Se{constructor(s){super(),Ee(this,s,$e,Je,le,{settings:0,board:1})}}function De(i){let s,e,n,r;const m=i[11].default,o=Me(m,i,i[10],null);let c=[i[5],{class:e="positionable "+(i[5].class||"")},{style:n=i[2]+" "+(i[5].style||"")}],a={};for(let l=0;l<c.length;l+=1)a=oe(a,c[l]);return{c(){s=U("div"),o&&o.c(),this.h()},l(l){s=B(l,"DIV",{class:!0,style:!0});var u=C(s);o&&o.l(u),u.forEach(g),this.h()},h(){he(s,a),xe(s,"svelte-1p7nrv8",!0)},m(l,u){k(l,s,u),o&&o.m(s,null),r=!0},p(l,u){o&&o.p&&(!r||u&1024)&&Le(o,m,l,l[10],r?Ie(m,l[10],u,null):Ne(l[10]),null),he(s,a=Ze(c,[u&32&&l[5],(!r||u&32&&e!==(e="positionable "+(l[5].class||"")))&&{class:e},(!r||u&36&&n!==(n=l[2]+" "+(l[5].style||"")))&&{style:n}])),xe(s,"svelte-1p7nrv8",!0)},i(l){r||(A(o,l),r=!0)},o(l){q(o,l),r=!1},d(l){l&&g(s),o&&o.d(l)}}}function et(i){let s,e,n=(!i[0].CULL||i[1])&&De(i);return{c(){n&&n.c(),s=pe()},l(r){n&&n.l(r),s=pe()},m(r,m){n&&n.m(r,m),k(r,s,m),e=!0},p(r,[m]){!r[0].CULL||r[1]?n?(n.p(r,m),m&3&&A(n,1)):(n=De(r),n.c(),A(n,1),n.m(s.parentNode,s)):n&&(Ae(),q(n,1,1,()=>{n=null}),We())},i(r){e||(A(n),e=!0)},o(r){q(n),e=!1},d(r){r&&g(s),n&&n.d(r)}}}function tt(i,s,e){let n,r;const m=["pos","size","z"];let o=_e(s,m),c,a,{$$slots:l={},$$scope:u}=s,{pos:b}=s,{size:p}=s,{z:d=1}=s;const _=be("board");se(i,_,y=>e(9,c=y));const w=be("settings");se(i,w,y=>e(0,a=y));function O(y,z={x:620,y:340}){return Fe()&&(z.x=window.innerWidth,z.y=window.innerHeight),b.x>y.x-a.CULL_MARGIN&&b.y>y.y-a.CULL_MARGIN&&b.x+p.x<y.x+a.CULL_MARGIN+z.x/c.zoom&&b.y+p.y<y.y+a.CULL_MARGIN+z.y/c.zoom}return i.$$set=y=>{s=oe(oe({},s),He(y)),e(5,o=_e(s,m)),"pos"in y&&e(6,b=y.pos),"size"in y&&e(7,p=y.size),"z"in y&&e(8,d=y.z),"$$scope"in y&&e(10,u=y.$$scope)},i.$$.update=()=>{i.$$.dirty&449&&e(2,n=`transform: translate(${a.SNAP_TO_GRID?Z(b.x,a.GRID_SIZE):b.x}px, ${a.SNAP_TO_GRID?Z(b.y,a.GRID_SIZE):b.y}px); width: ${a.SNAP_TO_GRID?Z(p.x,a.GRID_SIZE):p.x}px; height: ${a.SNAP_TO_GRID?Z(p.y,a.GRID_SIZE):p.y}px; z-index: ${d};`),i.$$.dirty&512&&e(1,r=O(c.viewOffset))},[a,r,n,_,w,o,b,p,d,c,u,l]}class st extends Se{constructor(s){super(),Ee(this,s,tt,et,le,{pos:6,size:7,z:8})}}st.__docgen={version:3,name:"Positionable.svelte",data:[{visibility:"public",description:null,keywords:[],name:"pos",kind:"let",static:!1,readonly:!1,type:{kind:"type",text:"any",type:"any"}},{visibility:"public",description:null,keywords:[],name:"size",kind:"let",static:!1,readonly:!1,type:{kind:"type",text:"any",type:"any"}},{visibility:"public",description:null,keywords:[],name:"z",kind:"let",static:!1,readonly:!1,type:{kind:"type",text:"number",type:"number"},defaultValue:1}],computed:[],methods:[],components:[],description:null,keywords:[],events:[],slots:[{keywords:[],visibility:"public",description:"",name:"default"}],refs:[]};export{it as B,st as P,ie as h,Z as s,je as w};
//# sourceMappingURL=Positionable-25bab829.js.map
