import{u as A,s as fe,S as Se,i as Ee,F as Me,a as se,e as B,d as ne,c as C,b as T,f as w,h as N,j as Y,k as U,z as R,G as Le,H as ke,I as Ne,m as W,t as J,P as Te,n as Ge,V as k,W as ee,E as oe,K as Re,X as E,w as q,x as F,y as ie,Y as ye,L as Ve,J as pe,o as Ae,l as We,Q as _e,D as he,N as le,R as He,O as be,Z as ge}from"./index-76d2f1d2.js";import{g as Ze}from"./spread-8a54911c.js";const Ke=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,G=[];function je(i,s=A){let e;const n=new Set;function r(c){if(fe(i,c)&&(i=c,e)){const a=!G.length;for(const l of n)l[1](),G.push(l,i);if(a){for(let l=0;l<G.length;l+=2)G[l][0](G[l+1]);G.length=0}}}function m(c){r(c(i))}function o(c,a=A){const l=[c,a];return n.add(l),n.size===1&&(e=s(r,m)||A),c(i),()=>{n.delete(l),n.size===0&&e&&(e(),e=null)}}return{set:r,update:m,subscribe:o}}const V=(i,s=0,e=1)=>Math.min(e,Math.max(s,i));function re(i,s){return i?i.classList.contains(s)?!0:i.parentElement?re(i.parentElement,s):!1:!1}function j(i,s){return Math.round(i/s)*s}const te=new Map;function qe(i,s,e){te.has(i)&&clearTimeout(te.get(i));const n=setTimeout(e,s);te.set(i,n)}function Fe(){return typeof window<"u"}const{window:xe}=Ke;function we(i){var m,o;let s,e,n=((m=i[8].DEV)==null?void 0:m.SHOW_POS)&&ze(i),r=((o=i[8].DEV)==null?void 0:o.SHOW_MODE)&&ve(i);return{c(){s=B("div"),n&&n.c(),e=se(),r&&r.c(),this.h()},l(c){s=C(c,"DIV",{style:!0});var a=T(s);n&&n.l(a),e=ne(a),r&&r.l(a),a.forEach(w),this.h()},h(){E(s,"position","absolute"),E(s,"right","1ch"),E(s,"top","1ch"),E(s,"background","darkblue"),E(s,"z-index","200"),E(s,"color","#fff"),E(s,"padding","4px"),E(s,"display","flex"),E(s,"gap","2ch"),E(s,"user-select","none"),E(s,"pointer-events","none")},m(c,a){Y(c,s,a),n&&n.m(s,null),U(s,e),r&&r.m(s,null)},p(c,a){var l,u;(l=c[8].DEV)!=null&&l.SHOW_POS?n?n.p(c,a):(n=ze(c),n.c(),n.m(s,e)):n&&(n.d(1),n=null),(u=c[8].DEV)!=null&&u.SHOW_MODE?r?r.p(c,a):(r=ve(c),r.c(),r.m(s,null)):r&&(r.d(1),r=null)},d(c){c&&w(s),n&&n.d(),r&&r.d()}}}function ze(i){let s,e=i[2].viewOffset.x+"",n,r,m=i[2].viewOffset.y+"",o;return{c(){s=B("span"),n=q(e),r=q(" - "),o=q(m)},l(c){s=C(c,"SPAN",{});var a=T(s);n=F(a,e),r=F(a," - "),o=F(a,m),a.forEach(w)},m(c,a){Y(c,s,a),U(s,n),U(s,r),U(s,o)},p(c,a){a&4&&e!==(e=c[2].viewOffset.x+"")&&ie(n,e),a&4&&m!==(m=c[2].viewOffset.y+"")&&ie(o,m)},d(c){c&&w(s)}}}function ve(i){let s,e;return{c(){s=B("span"),e=q(i[3])},l(n){s=C(n,"SPAN",{});var r=T(s);e=F(r,i[3]),r.forEach(w)},m(n,r){Y(n,s,r),U(s,e)},p(n,r){r&8&&ie(e,n[3])},d(n){n&&w(s)}}}function Oe(i){let s;return{c(){s=B("div"),this.h()},l(e){s=C(e,"DIV",{class:!0,style:!0}),T(s).forEach(w),this.h()},h(){N(s,"class","selection-rect svelte-xlkx4x"),N(s,"style",i[6])},m(e,n){Y(e,s,n)},p(e,n){n&64&&N(s,"style",e[6])},d(e){e&&w(s)}}}function Je(i){let s=Object.values(i[8].DEV).includes(!0),e,n,r,m,o,c,a,l=s&&we(i),u=(i[3]==="select"||i[3]==="draw")&&Oe(i);const g=i[16].default,p=Me(g,i,i[15],null);return{c(){l&&l.c(),e=se(),n=B("div"),r=B("div"),u&&u.c(),m=se(),p&&p.c(),this.h()},l(d){l&&l.l(d),e=ne(d),n=C(d,"DIV",{class:!0,style:!0});var _=T(n);r=C(_,"DIV",{class:!0,style:!0});var z=T(r);u&&u.l(z),m=ne(z),p&&p.l(z),z.forEach(w),_.forEach(w),this.h()},h(){N(r,"class","board svelte-xlkx4x"),N(r,"style",i[7]),N(n,"class","container svelte-xlkx4x"),N(n,"style",i[5])},m(d,_){l&&l.m(d,_),Y(d,e,_),Y(d,n,_),U(n,r),u&&u.m(r,null),U(r,m),p&&p.m(r,null),i[17](n),o=!0,c||(a=[R(xe,"keydown",i[11]),R(xe,"keyup",i[12]),R(n,"mousedown",i[13]),R(n,"touchstart",i[13],{passive:!1}),R(n,"wheel",i[10],{passive:!1})],c=!0)},p(d,[_]){_&256&&(s=Object.values(d[8].DEV).includes(!0)),s?l?l.p(d,_):(l=we(d),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null),d[3]==="select"||d[3]==="draw"?u?u.p(d,_):(u=Oe(d),u.c(),u.m(r,m)):u&&(u.d(1),u=null),p&&p.p&&(!o||_&32768)&&Le(p,g,d,d[15],o?Ne(g,d[15],_,null):ke(d[15]),null),(!o||_&128)&&N(r,"style",d[7]),(!o||_&32)&&N(n,"style",d[5])},i(d){o||(W(p,d),o=!0)},o(d){J(p,d),o=!1},d(d){d&&(w(e),w(n)),l&&l.d(d),u&&u.d(),p&&p.d(d),i[17](null),c=!1,Te(a)}}}function Qe(){document.body.classList.add("panning")}function $e(i,s,e){let n,r,m,o,c=A,a=()=>(c(),c=ye(v,f=>e(2,o=f)),v),l,u,g=A,p=()=>(g(),g=ye(z,f=>e(8,u=f)),z);i.$$.on_destroy.push(()=>c()),i.$$.on_destroy.push(()=>g());let{$$slots:d={},$$scope:_}=s,{settings:z}=s;p();let{board:v}=s;a();const M=Ge();k(z,u={CAN_ZOOM:!0,SNAP_TO_GRID:!1,GRID_SIZE:20,CULL:!0,CULL_MARGIN:400,DEV:{SHOW_POS:!1,SHOW_MODE:!1},...u,BOUNDS:{minX:null,maxX:null,minY:null,maxY:null,maxZoom:3,minZoom:0,limit:"hard",...u.BOUNDS}},u),k(v,o={zoom:1,viewOffset:{x:0,y:0},viewSize:{x:1280,y:720},viewPort:{x:0,y:0,w:0,h:0},...o},o),ee("board",v),ee("settings",z);let y=je("draw");oe(i,y,f=>e(3,l=f)),ee("mode",y);let L,I={init:{x:0,y:0},curr:{x:0,y:0},offset:{x:0,y:0}},t={init:{x:0,y:0},curr:{x:0,y:0},offset:{x:0,y:0},pos:{x:0,y:0},size:{x:0,y:0}};function H(f,O){return{x:f-o.viewPort.x,y:O-o.viewPort.y+window.scrollY}}function Ie(){document.body.classList.add("drawing"),M("drawStart")}function ue(){document.body.classList.remove("drawing"),document.removeEventListener("mousemove",$),document.removeEventListener("touchmove",$),e(14,t={init:{x:0,y:0},curr:{x:0,y:0},offset:{x:0,y:0},pos:{x:0,y:0},size:{x:0,y:0}})}function ae(){document.body.classList.remove("panning"),document.removeEventListener("mousemove",Z),document.removeEventListener("touchmove",Z),M("panEnd",{offset:o.viewOffset})}function Ye(){M("selectStart"),document.body.classList.add("selecting"),document.addEventListener("mousemove",Q)}function ce(){document.body.classList.remove("selecting"),document.removeEventListener("mousemove",Q)}function Xe(f){if(f.ctrlKey){if(f.preventDefault(),f.stopPropagation(),!u.CAN_ZOOM)return;k(y,l="zoom",l);const O=o.viewOffset.x+f.clientX/o.zoom,b=o.viewOffset.y+f.clientY/o.zoom,h=f.deltaY,x=V(o.zoom-h/500,.1,1.9);k(v,o.zoom=x,o);const D=o.viewOffset.x+f.clientX/x,S=o.viewOffset.y+f.clientY/x,X=O-D,P=b-S;k(v,o.viewOffset={x:o.viewOffset.x+X,y:o.viewOffset.y+P},o)}else{if(re(f.target,"tela-ignore"))return;f.preventDefault(),f.stopPropagation();const O=f.deltaX,b=f.deltaY,h=V(o.viewOffset.x+O,u.BOUNDS.minX!==null?u.BOUNDS.minX:-1/0,u.BOUNDS.maxX!==null?u.BOUNDS.maxX-window.innerWidth:1/0),x=V(o.viewOffset.y+b,u.BOUNDS.minY!==null?u.BOUNDS.minY:-1/0,u.BOUNDS.maxY!==null?u.BOUNDS.maxY-window.innerHeight:1/0);k(v,o.viewOffset={x:h,y:x},o),qe("remove_trackpad_panning",100,()=>document.body.classList.remove("panning"))}M("zoomEnd",{zoom:o.zoom})}function Pe(f){f.shiftKey?y.set("select"):f.metaKey&&y.set("pan")}function Ue(f){!f.shiftKey&&!f.metaKey&&(l==="draw"&&ue(),(l==="pan"||l==="panning")&&ae(),l==="select"&&ce(),y.set("draw"))}function Be(f){var x,D,S,X,P,de,me;const O=((D=(x=f.targetTouches)==null?void 0:x.item(0))==null?void 0:D.target)||f.target,{x:b,y:h}=H(((X=(S=f.targetTouches)==null?void 0:S.item(0))==null?void 0:X.clientX)||f.clientX,((de=(P=f.targetTouches)==null?void 0:P.item(0))==null?void 0:de.clientY)||f.clientY);re(O,"tela-ignore")||((l==="pan"||((me=f.targetTouches)==null?void 0:me.length)===1)&&y.set("panning"),l==="draw"?(f.stopPropagation(),Ie(),e(14,t.init={x:b,y:h},t),e(14,t.curr={x:b,y:h},t),e(14,t.pos={x:b,y:h},t),e(14,t.size={x:0,y:0},t),document.addEventListener("mousemove",$),document.addEventListener("mouseup",K,{once:!0})):l==="panning"?(f.stopPropagation(),Qe(),I.init={x:b,y:h},I.curr={x:b,y:h},document.addEventListener("mousemove",Z),document.addEventListener("mouseup",K,{once:!0}),document.addEventListener("touchmove",Z),document.addEventListener("touchend",K,{once:!0})):l==="select"&&(f.stopPropagation(),Ye(),e(14,t.init={x:b,y:h},t),e(14,t.curr={x:b,y:h},t),e(14,t.pos={x:b,y:h},t),e(14,t.size={x:0,y:0},t),document.addEventListener("mousemove",Q),document.addEventListener("mouseup",K,{once:!0})))}function Z(f){var D,S,X,P;const{x:O,y:b}=H(((S=(D=f.targetTouches)==null?void 0:D.item(0))==null?void 0:S.clientX)||f.clientX,((P=(X=f.targetTouches)==null?void 0:X.item(0))==null?void 0:P.clientY)||f.clientY);I.offset={x:Math.floor(O-I.curr.x),y:Math.floor(b-I.curr.y)},I.curr={x:O,y:b};const h=V(o.viewOffset.x-I.offset.x,u.BOUNDS.minX!==null?u.BOUNDS.minX:-1/0,u.BOUNDS.maxX!==null?u.BOUNDS.maxX-window.innerWidth:1/0),x=V(o.viewOffset.y-I.offset.y,u.BOUNDS.minY!==null?u.BOUNDS.minY:-1/0,u.BOUNDS.maxY!==null?u.BOUNDS.maxY-window.innerHeight:1/0);k(v,o.viewOffset={x:h,y:x},o)}function Q(f){var h,x,D,S;const{x:O,y:b}=H(((x=(h=f.targetTouches)==null?void 0:h.item(0))==null?void 0:x.clientX)||f.clientX,((S=(D=f.targetTouches)==null?void 0:D.item(0))==null?void 0:S.clientY)||f.clientY);e(14,t.offset={x:-Math.floor(t.init.x-t.curr.x),y:-Math.floor(t.init.y-t.curr.y)},t),e(14,t.pos.x=t.init.x,t),e(14,t.pos.y=t.init.y,t),e(14,t.size.x=t.offset.x/o.zoom,t),e(14,t.size.y=t.offset.y/o.zoom,t),t.size.x<0&&(e(14,t.size.x=Math.abs(t.offset.x/o.zoom),t),e(14,t.pos.x=t.init.x-t.size.x*o.zoom,t)),t.size.y<0&&(e(14,t.size.y=Math.abs(t.offset.y/o.zoom),t),e(14,t.pos.y=t.init.y-t.size.y*o.zoom,t)),e(14,t.curr={x:O,y:b},t),M("selectMove",{selectState:t})}function $(f){var h,x,D,S;const{x:O,y:b}=H(((x=(h=f.targetTouches)==null?void 0:h.item(0))==null?void 0:x.clientX)||f.clientX,((S=(D=f.targetTouches)==null?void 0:D.item(0))==null?void 0:S.clientY)||f.clientY);e(14,t.offset={x:-Math.floor(t.init.x-t.curr.x),y:-Math.floor(t.init.y-t.curr.y)},t),e(14,t.pos.x=t.init.x,t),e(14,t.pos.y=t.init.y,t),e(14,t.size.x=t.offset.x/o.zoom,t),e(14,t.size.y=t.offset.y/o.zoom,t),t.size.x<0&&(e(14,t.size.x=Math.abs(t.offset.x/o.zoom),t),e(14,t.pos.x=t.init.x-t.size.x*o.zoom,t)),t.size.y<0&&(e(14,t.size.y=Math.abs(t.offset.y/o.zoom),t),e(14,t.pos.y=t.init.y-t.size.y*o.zoom,t)),e(14,t.curr={x:O,y:b},t)}function K(f){l==="draw"?(M("drawEnd",{selection:{pos:t.pos,size:t.size}}),ue()):l==="panning"?(k(y,l="pan",l),ae()):l==="select"&&(ce(),M("selectEnd",{selectState:t}),e(14,t={init:{x:0,y:0},curr:{x:0,y:0},offset:{x:0,y:0},pos:{x:0,y:0},size:{x:0,y:0}}))}Re(()=>{const f=L.getBoundingClientRect();k(v,o.viewPort={x:f.x,y:f.y,w:f.right-f.left,h:f.bottom-f.top},o)});function Ce(f){Ve[f?"unshift":"push"](()=>{L=f,e(4,L)})}return i.$$set=f=>{"settings"in f&&p(e(0,z=f.settings)),"board"in f&&a(e(1,v=f.board)),"$$scope"in f&&e(15,_=f.$$scope)},i.$$.update=()=>{i.$$.dirty&4&&e(7,n=`transform-origin: top left; transform: scale(${o.zoom}) translate(${-o.viewOffset.x}px, ${-o.viewOffset.y}px);`),i.$$.dirty&16388&&e(6,r=`transform: translate(${o.viewOffset.x+t.pos.x/o.zoom}px, ${o.viewOffset.y+t.pos.y/o.zoom}px); width: ${Math.round(t.size.x)}px; height: ${Math.round(t.size.y)}px;`),i.$$.dirty&8&&e(5,m=`cursor: ${l==="draw"?"crosshair":l==="select"?"default":l==="pan"?"grab":l==="panning"?"grabbing":"crosshair"};`)},[z,v,o,l,L,m,r,n,u,y,Xe,Pe,Ue,Be,t,_,d,Ce]}class it extends Se{constructor(s){super(),Ee(this,s,$e,Je,fe,{settings:0,board:1})}}function De(i){let s,e,n,r;const m=i[12].default,o=Me(m,i,i[11],null);let c=[i[6],{class:e="positionable "+(i[6].class||"")},{style:n=i[3]+" "+(i[6].style||"")}],a={};for(let l=0;l<c.length;l+=1)a=le(a,c[l]);return{c(){s=B("div"),o&&o.c(),this.h()},l(l){s=C(l,"DIV",{class:!0,style:!0});var u=T(s);o&&o.l(u),u.forEach(w),this.h()},h(){be(s,a),ge(s,"svelte-1p7nrv8",!0)},m(l,u){Y(l,s,u),o&&o.m(s,null),r=!0},p(l,u){o&&o.p&&(!r||u&2048)&&Le(o,m,l,l[11],r?Ne(m,l[11],u,null):ke(l[11]),null),be(s,a=Ze(c,[u&64&&l[6],(!r||u&64&&e!==(e="positionable "+(l[6].class||"")))&&{class:e},(!r||u&72&&n!==(n=l[3]+" "+(l[6].style||"")))&&{style:n}])),ge(s,"svelte-1p7nrv8",!0)},i(l){r||(W(o,l),r=!0)},o(l){J(o,l),r=!1},d(l){l&&w(s),o&&o.d(l)}}}function et(i){let s,e,n=(i[0]===void 0?!i[1].CULL||i[2]:!i[0]||i[2])&&De(i);return{c(){n&&n.c(),s=pe()},l(r){n&&n.l(r),s=pe()},m(r,m){n&&n.m(r,m),Y(r,s,m),e=!0},p(r,[m]){(r[0]===void 0?!r[1].CULL||r[2]:!r[0]||r[2])?n?(n.p(r,m),m&7&&W(n,1)):(n=De(r),n.c(),W(n,1),n.m(s.parentNode,s)):n&&(Ae(),J(n,1,1,()=>{n=null}),We())},i(r){e||(W(n),e=!0)},o(r){J(n),e=!1},d(r){r&&w(s),n&&n.d(r)}}}function tt(i,s,e){let n,r;const m=["pos","size","z","cull"];let o=_e(s,m),c,a,{$$slots:l={},$$scope:u}=s,{pos:g}=s,{size:p}=s,{z:d=1}=s,{cull:_=void 0}=s;const z=he("board");oe(i,z,y=>e(10,c=y));const v=he("settings");oe(i,v,y=>e(1,a=y));function M(y,L={x:620,y:340}){return Fe()&&(L.x=window.innerWidth,L.y=window.innerHeight),g.x>y.x-a.CULL_MARGIN&&g.y>y.y-a.CULL_MARGIN&&g.x+p.x<y.x+a.CULL_MARGIN+L.x/c.zoom&&g.y+p.y<y.y+a.CULL_MARGIN+L.y/c.zoom}return i.$$set=y=>{s=le(le({},s),He(y)),e(6,o=_e(s,m)),"pos"in y&&e(7,g=y.pos),"size"in y&&e(8,p=y.size),"z"in y&&e(9,d=y.z),"cull"in y&&e(0,_=y.cull),"$$scope"in y&&e(11,u=y.$$scope)},i.$$.update=()=>{i.$$.dirty&898&&e(3,n=`transform: translate3d(${a.SNAP_TO_GRID?j(g.x,a.GRID_SIZE):g.x}px, ${a.SNAP_TO_GRID?j(g.y,a.GRID_SIZE):g.y}px, 0); width: ${a.SNAP_TO_GRID?j(p.x,a.GRID_SIZE):p.x}px; height: ${a.SNAP_TO_GRID?j(p.y,a.GRID_SIZE):p.y}px; z-index: ${d};`),i.$$.dirty&1024&&e(2,r=M(c.viewOffset))},[_,a,r,n,z,v,o,g,p,d,c,u,l]}class st extends Se{constructor(s){super(),Ee(this,s,tt,et,fe,{pos:7,size:8,z:9,cull:0})}}st.__docgen={version:3,name:"Positionable.svelte",data:[{visibility:"public",description:null,keywords:[],name:"pos",kind:"let",static:!1,readonly:!1,type:{kind:"type",text:"any",type:"any"}},{visibility:"public",description:null,keywords:[],name:"size",kind:"let",static:!1,readonly:!1,type:{kind:"type",text:"any",type:"any"}},{visibility:"public",description:null,keywords:[],name:"z",kind:"let",static:!1,readonly:!1,type:{kind:"type",text:"number",type:"number"},defaultValue:1},{visibility:"public",description:null,keywords:[],name:"cull",kind:"let",static:!1,readonly:!1,type:{kind:"type",text:"any",type:"any"}}],computed:[],methods:[],components:[],description:null,keywords:[],events:[],slots:[{keywords:[],visibility:"public",description:"",name:"default"}],refs:[]};export{it as B,st as P,re as h,j as s,je as w};
//# sourceMappingURL=Positionable-6a060a99.js.map
